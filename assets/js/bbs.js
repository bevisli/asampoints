var thisdomain=document.domain;var sitedomain="http://"+thisdomain;var huishi={};huishi.GetLength=function(str){var realLength=0,len=removeHTMLTag(str).length,charCode=-1;for(var i=0;i<len;i++){charCode=str.charCodeAt(i);if(charCode>=0&&charCode<=128)realLength+=1;else realLength+=1;}
return realLength;};function removeHTMLTag(str){str=str.replace(/<\/?[^>]*>/g,'');str=str.replace(/[ | ]*\n/g,'\n');str=str.replace(/&nbsp;/ig,'');return str;}
$(function(){var rollStart=$('.free-subnav'),rollSet=$('.free-subnav');var offset=rollStart.offset(),objWindow=$(window),rollBox=rollStart.prev();if(rollSet.length>0){if(objWindow.width()>960){objWindow.scroll(function(){if(objWindow.scrollTop()>offset.top){rollStart.css('position','fixed');rollStart.css('width','18.4%');rollStart.stop().animate({top:10},200)}else{rollStart.css('position','static');rollStart.css('width','100%');rollStart.stop().animate({top:0},200)}})}}
$(".onclk_type").click(function(){var typearr=$(this).attr("datetype");$(".onclk_type").removeClass('btn-primary');$(".onclk_type").addClass('btn-default');$("#p_type").val(typearr);$(this).removeClass('btn-default');$(this).addClass('btn-primary');});$("#p_name").blur(function(){if(huishi.GetLength($.trim($('#p_name').val()))<8){showalert(1,'标题不为空或长度不够，需8个字以上。');$(this).removeClass('has-success');$(this).addClass('has-error');}else{$(this).removeClass('has-error');$(this).addClass('has-success');}});var loc_pos=$('.comment-ul li[data-key='+loc_id+']');if(loc_id>0){if(loc_pos.length>0){$('body,html').animate({scrollTop:loc_pos.offset().top-90},800,function(){$('.comment-ul li[data-key='+loc_id+']').css("background-color","#FCFFD1");setTimeout("$('.comment-ul li[data-key="+loc_id+"]').css('background-color','#FFFFFF')",280);setTimeout("$('.comment-ul li[data-key="+loc_id+"]').css('background-color','#FCFFD1')",560);setTimeout("$('.comment-ul li[data-key="+loc_id+"]').css('background-color','#FFFFFF')",840);setTimeout("$('.comment-ul li[data-key="+loc_id+"]').css('background-color','#FCFFD1')",1120);setTimeout("$('.comment-ul li[data-key="+loc_id+"]').css('background-color','#FFFFFF')",1400);});}}
$(".manage_div").hover(function(){var tid=$(this).attr('post-key');if($(this).find('.label-hot').length){var diggtools='<img src="/assets/icons/asterisk_orange.png"><a href="javascript:;" onclick="cancelgoodpost('+tid+');">取消加精</a>';}else{var diggtools='<img src="/assets/icons/asterisk_orange.png"><a href="javascript:;" onclick="goodpost('+tid+');">加精</a>';}
if($(this).find('.label-top').length){var toptools='<img src="/assets/icons/rocket.png"><a href="javascript:;" onclick="canceltoppost('+tid+');">取消置顶</a>';}else{var toptools='<img src="/assets/icons/rocket.png"><a href="javascript:;" onclick="toppost('+tid+');">置顶</a>';}
$(this).addClass('manage_div_box');$(this).append('     <div class="manage-tools">     <img src="/assets/icons/application_edit.png"><a href="javascript:;" onclick="editpost('+tid+');">编辑</a>      <img src="/assets/icons/delete.png"><a href="javascript:;" onclick="delpost('+tid+');">删除</a>      '+toptools+'     '+diggtools+'     <img src="/assets/icons/arrow_branch.png"><a href="javascript:;" onclick="movepost('+tid+');">移动</a>     </div>');},function(){$(this).removeClass('manage_div_box');$('.manage-tools').remove();});$(".manage_comment").hover(function(){var comid=$(this).attr('data-key');$(this).addClass('manage_div_box');$(this).append('<div class="manage-tools">  <img src="/assets/icons/delete.png"><a href="javascript:;" onclick="delcomment('+comid+');">删除</a>    </div>');},function(){$(this).removeClass('manage_div_box');$('.manage-tools').remove();});$(".comment-reply2").click(function(){$('body,html').stop().animate({'scrollTop':$("#comment-reply-topic").offset().top},800);return false;});$(".comment-reply2").click(function(){$('body,html').stop().animate({'scrollTop':$("#comment-reply-topic").offset().top},800);return false;});$(".grade_btn").click(function(){var post_id=$(this).attr('data-tid-grade');getshowgrade(post_id);});$(".comment-reply-btm").click(function(){var comid=$(this).attr('comment-key').split('|')[0];var rpcomid=$(this).attr('comment-key').split('|')[1];if($('#qa-reply'+comid).is(":hidden")){$('#qa-reply'+comid).html('<center style="margin:5px;"><img src="/assets/images/loading.gif"></center>');$('#qa-reply'+comid).fadeIn();$.post(""+sitedomain+"/ajax/",{act:'getcommenttextbox',sid:comid,rpid:rpcomid},function(data,status){if(data){$('#qa-reply'+comid).html(data);}});}else{$('#qa-reply'+comid).fadeOut();}});});function getintext(){showalert(0,'<p>输入需回复后才能查看的内容：</p><p><textarea maxlength="5000" name="getintexts" id="getintexts" class="js-reply-ipt"  style="overflow: hidden; word-wrap: break-word;width:248px;height:80px;"></textarea></p><p><a href="javascript:;" onclick="getintextintext();">确定</a> 　 <a href="javascript:;" onclick="hiddendiv();">取消</a></p>');}
function getintextintext(){var value="[回复显示]"+$('#getintexts').val()+"[/回复显示]";UE.getEditor('editor').execCommand('insertHtml',value)
$('#getintexts').val('');hiddendiv();}
function getshowgrade(post_id){showalert(0,'<p>对该帖用户进行评分操作：</p><p style="height: 20px;line-height: 20px;"><select name="grade_type" id="grade_type"><option value="+">加</option><option value="-">减</option></select> 分数：<input onkeyup="this.value=this.value.replace(/[^\\d]/g,\'\')" name="grade_score" id="grade_score" value="" style="height: 20px;width:40px;line-height: 20px;"></p><p>备注理由：<br /><textarea maxlength="2000" name="grade_beizhu" id="grade_beizhu" class="js-reply-ipt"  style="overflow: hidden; word-wrap: break-word;width:150px;height:50px;"></textarea></p><p><a href="javascript:;" onclick="postgrade('+post_id+');">确定</a> 　 <a href="javascript:;" onclick="hiddendiv();">取消</a></p>');}
function postgrade(post_id){var val=encodeURI(encodeURI($('#searchinput').val()));$.post(""+sitedomain+"/ajax/",{act:'postgrade',sid:post_id,grade_type:$('#grade_type').val(),grade_score:$('#grade_score').val(),grade_beizhu:$('#grade_beizhu').val()},function(data,status){if(data){$('.ratl_l').html(data);showalert(1,'评分成功！');}else{showalert(1,'评分失败！');}});}
function gosearch(){var val=encodeURI(encodeURI($('#searchinput').val()));$.post(""+sitedomain+"/ajax/",{act:'searchinput',fid:$('#fid').val(),context:val},function(data,status){if(data){top.location.href=data;window.location.href=data;}else{showalert(1,'请确认搜索内容！');}});}
function qareplypost(otext,comxid){var comid=comxid.split('|')[0];var rpcomid=comxid.split('|')[1];var comcontext=$('#commentcontext'+comid).val().trim();var comcontext=comcontext.trim();var otext=otext.trim();if(!comcontext||comcontext==otext){showalert(1,'请确认回复内容！');return false;}
$.post(""+sitedomain+"/ajax/",{act:'addcommentminido',sid:comid,rpid:rpcomid,context:comcontext},function(data,status){if(data){$('#qa-reply-c-s-'+comid).prepend(data);$('#commentcontext'+comid).val('');}else{showalert(1,'回复失败！请确认内容或者稍后尝试！');}});}
function movepost(tid){$.post(""+sitedomain+"/ajax/",{act:'movepost',sid:tid},function(data,status){if(data){showalert(0,data);}});}
function movepostdo(){$.post(""+sitedomain+"/ajax/",{act:'movepostdo',sid:$('#m_tid').val(),m_fid:$('#m_fid').val(),m_typeid:$('#m_typeid').val()},function(data,status){if(data){showalert(1,data);if($('#o_fid').val()!=$('#m_fid').val()){$('li[post-key='+$('#m_tid').val()+']').remove();}}else{showalert(1,'移动失败！');}});}
function showforumtype(val){$.post(""+sitedomain+"/ajax/",{act:'showforumtype',sid:val},function(data,status){if(data){$('#showtype').html(data);}else{$('#showtype').html('无子类别！');}});}
function canceltoppost(tid){showalert(0,"确定要取消置顶吗？<br /><a href='javascript:;' onclick='canceltoppostdo("+tid+");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");}
function canceltoppostdo(val){$.post(""+sitedomain+"/ajax/",{act:'canceltoppostdo',sid:val},function(data,status){if(data){showalert(1,data);$('li[post-key='+val+']').find('.label-top').remove();}else{showalert(1,'取消置顶失败！');}});}
function ga(val){if(val=='everyday'){showalert(0,'<center style="width:180px;display:block;"><div class="eggluck">今日RP如何？砸了就知道！</div><a href="javascript:;" onclick="gatodo();" style="border:0px;background-color:transparent;"><img src="/assets/images/egg_1.png"></a></center>','#eggbox');}}
function gatodo(val){$.post(""+sitedomain+"/ajax/",{act:'everydaycheck'},function(data,status){if(data){
var strnum=data;
strnum=strnum[strnum.length-1];
strnum=strnum.replace('>','',strnum);
var oldscoredate=$('#scoreshow').html();showalert(0,'<center style="width:180px;display:block;"><div class="eggluck">恭喜获得<b style="font-size: 15px;color: #221B72;font-weight: bold;padding: 4px;">'+data+'</b>积分!</div><img src="/assets/images/egg_2.png"><br /><a href="javascript:;" onclick="hiddendiv(\'#eggbox\');">确定</a></center>','#eggbox');$('#user_info_tosign').addClass('signScoreGrey');$('#user_info_tosign').removeClass('signScore');$('#user_info_tosign').attr('onclick','');$('#scoreshow').html(parseInt(oldscoredate)+parseInt(strnum));}else{showalert(1,'服务器繁忙请稍后尝试！');}});}
function canceltoppostdo(val){$.post(""+sitedomain+"/ajax/",{act:'canceltoppostdo',sid:val},function(data,status){if(data){showalert(1,data);$('li[post-key='+val+']').find('.label-top').remove();}else{showalert(1,'取消置顶失败！');}});}
function toppost(tid){showalert(0,"确定要置顶该贴吗？<br /><a href='javascript:;' onclick='toppostdo("+tid+");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");}
function toppostdo(val){$.post(""+sitedomain+"/ajax/",{act:'toppostdo',sid:val},function(data,status){if(data){showalert(1,data);$('li[post-key='+val+']').find('.label-top').remove();$('li[post-key='+val+']').find('.platact_type').append('<span class="label label-top" title="精华"></span>');}else{showalert(1,'置顶失败！');}});}
function cancelgoodpost(tid){showalert(0,"确定要取消精华吗？<br /><a href='javascript:;' onclick='cancelgoodpostdo("+tid+");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");}
function cancelgoodpostdo(val){$.post(""+sitedomain+"/ajax/",{act:'cancelgoodpostdo',sid:val},function(data,status){if(data){showalert(1,data);$('li[post-key='+val+']').find('.label-hot').remove();}else{showalert(1,'取消加精失败！');}});}
function goodpost(tid){showalert(0,"确定要加精该贴吗？<br /><a href='javascript:;' onclick='goodpostdo("+tid+");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");}
function goodpostdo(val){$.post(""+sitedomain+"/ajax/",{act:'goodpostdo',sid:val},function(data,status){if(data){showalert(1,data);$('li[post-key='+val+']').find('.label-hot').remove();$('li[post-key='+val+']').find('.platact_type').append('<span class="label label-hot" title="精华"></span>');}else{showalert(1,'加精失败！');}});}
function delcomment(comid){showalert(0,"确定要删除回复吗？<br /><a href='javascript:;' onclick='delcommentdo(\""+comid+"\");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");}
function delcommentdo(val){$.post(""+sitedomain+"/ajax/",{act:'delcommentdo',sid:val},function(data,status){if(data){showalert(1,data);if($('li[data-key='+val+']').length>0){$('li[data-key='+val+']').fadeOut();}
if($('div[data-key='+val+']').length>0){$('div[data-key='+val+']').fadeOut();}}else{showalert(1,'删除失败！');}});}
function delpostin(tid){showalert(0,"确定要删除该贴吗？<br /><a href='javascript:;' onclick='delpostindo(\""+tid+"\");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");}
function delpostindo(val){$.post(""+sitedomain+"/ajax/",{act:'delpostdo',sid:val},function(data,status){if(data){window.opener=null;window.close();}else{showalert(1,'删除失败！');}});}
function delpost(tid){showalert(0,"确定要删除该贴吗？<br /><a href='javascript:;' onclick='delpostdo(\""+tid+"\");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");}
function delpostdo(val){$.post(""+sitedomain+"/ajax/",{act:'delpostdo',sid:val},function(data,status){if(data){showalert(1,data);$('li[post-key='+val+']').fadeOut();}else{showalert(1,'删除失败！');}});}
function editpost(tid){if(thisdomain=='www.huishiatc.com'){sitedomain=sitedomain+"/bbs";}
top.location.href=''+sitedomain+'/tid-'+tid+'~mod-edit/';}
function checkcontent(){if(huishi.GetLength(ue.getContent())<8){showalert(1,'为防止灌水，内容需达到8个字以上。');$('#edui1').removeClass('has-success');$('#edui1').addClass('has-error');}else{$('#edui1').removeClass('has-error');$('#edui1').addClass('has-success');}}
function checkcomment(){if(huishi.GetLength(ue.getContent())<5){showalert(1,'为防止灌水，内容需达到5个字以上。');$('#edui1').removeClass('has-success');$('#edui1').addClass('has-error');}else{$('#edui1').removeClass('has-error');$('#edui1').addClass('has-success');}}
function postsave(){var tjz='发布中...';$(".hs_postsave_btn").text(tjz).attr('disabled',true);var ispost=0;if(!$('#p_name').val()||huishi.GetLength($.trim($('#p_name').val()))<8){ispost=ispost+1;}
if(!UE.getEditor('editor').getContent()||huishi.GetLength(ue.getContent())<12){ispost=ispost+1;}
if(ispost==0){newform.submit();}else{showalert(1,'请确定您帖子的标题和内容。');$(".hs_postsave_btn").text('发 帖').attr('disabled',false);}}
function resetpostsave(){$(".hs_postsave_btn").text('发 帖').attr('disabled',false);}
function resetcomment(){$(".hs_comment_btn").text('回 帖').attr('disabled',false);}
function commentsave(){var tjz='提交中...';$(".hs_comment_btn").text(tjz).attr('disabled',true);var ispost=0;if(!UE.getEditor('editor').getContent()||huishi.GetLength(ue.getContent())<5){ispost=ispost+1;}
if(ispost==0){newform.submit();}else{showalert(1,'为防止灌水，回复内容需达到5个字以上。');$(".hs_comment_btn").text('回 帖').attr('disabled',false);}}