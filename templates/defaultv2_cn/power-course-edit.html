
<link rel="stylesheet" href="servtools/kindeditor-4.1.9.1/themes/default/default.css" />
<link rel="stylesheet" href="servtools/kindeditor-4.1.9.1/plugins/code/prettify.css" />
<script charset="utf-8" src="servtools/kindeditor-4.1.9.1/kindeditor.js"></script>
<script charset="utf-8" src="servtools/kindeditor-4.1.9.1/lang/zh_CN.js"></script>
<script charset="utf-8" src="servtools/kindeditor-4.1.9.1/plugins/code/prettify.js"></script>
<script>
	KindEditor.ready(function(K) {
		var editor1 = K.create('textarea[name="content"]', {
			cssPath : '/servtools/kindeditor-4.1.9.1/plugins/code/prettify.css',
			uploadJson : '/servtools/kindeditor-4.1.9.1/php/upload_json.php',
			fileManagerJson : '/servtools/kindeditor-4.1.9.1/php/file_manager_json.php',
			allowFlashUpload : false,
			allowMediaUpload : false,
			allowFileManager : false,
			afterCreate : function() {
				var self = this;
				K.ctrl(document, 13, function() {
					self.sync();
					K('form[name=example]')[0].submit();
				});
				K.ctrl(self.edit.doc, 13, function() {
					self.sync();
					K('form[name=example]')[0].submit();
				});
			}
		});

		
		var editor1 = K.create('textarea[name="summary"]', {
			cssPath : '/servtools/kindeditor-4.1.9.1/plugins/code/prettify.css',
			uploadJson : '/servtools/kindeditor-4.1.9.1/php/upload_json.php',
			fileManagerJson : '/servtools/kindeditor-4.1.9.1/php/file_manager_json.php',
			allowFlashUpload : false,
			allowMediaUpload : false,
			allowFileManager : false,
			afterCreate : function() {
				var self = this;
				K.ctrl(document, 13, function() {
					self.sync();
					K('form[name=example]')[0].submit();
				});
				K.ctrl(self.edit.doc, 13, function() {
					self.sync();
					K('form[name=example]')[0].submit();
				});
			}
		});
		prettyPrint();
	});
</script>
       <div id="content">
        	<div class="inner">
            	<div class="general_content">
                	<div class="main_content">
										  
					<script language="JavaScript" type="text/javascript" src="/layout/js/DatePicker/WdatePicker.js"></script>
					<script language="JavaScript" src="../servtools/ajax_client/ajax.js"></script>
					<script>
						$(document).ready(function(){
						$("#stime").click(function(){
						WdatePicker({minDate:'',doubleCalendar:false,dateFmt:'yyyy-MM-dd H:m'});
						});
						$("#etime").click(function(){
						WdatePicker({minDate:'',doubleCalendar:false,dateFmt:'yyyy-MM-dd H:m'});
						});
						});
					</script>
					<style>
					td span {color:red;}
					</style>
						<div class="alert alert-info">
							<a href="{echo:URL_NAV(CUTURL('power_'.$r[2]));/}">课程列表</a>
							<a> - </a>
							<a>编辑课程</a>
						</div>
							<form action="{echo:URL_NAV('power_'.$r[2]);/}" method="post" target="i_frame" enctype="multipart/form-data">
							<table class="table table-striped table-bordered bootstrap-datatable">
							<input type="hidden" name="act" value="edit">
								<tr style="display:none;">
									<td>状态：</td>
									<td><select name="status" data-rel="chosen">
										<?php if($showstatus){
										foreach($showstatus as $k=>$v) { ?>
											<option value="<?php echo $k;?>" <?php if($train_info['status']==$k){ echo "selected"; }?>><?php echo $v;?></option>
										<?php }
											}
										?>
									</select></td>
								</tr>
								<tr>
									<td width="75px">所属分类：</td>
									<td><select name="fenlei" id="fenlei" data-rel="chosen">
										<option value="0">选择分类</option>
										<option value="1" <?php if($train_info['fenlei']==1){?>selected<?php } ?>>模块课程</option>
										<option value="2" <?php if($train_info['fenlei']==2){?>selected<?php } ?>>综合课程</option>
										</select> <span>*</span>
									</td>
								</tr>
								<tr>
									<td width="75px">归属类别：</td>
									<td><select name="cat_id" id="cat_id" data-rel="chosen">
										<option value="0">选择类别</option>
										<?php if($sort_cat){
										foreach($sort_cat as $k=>$v) { ?>
											<option value="<?php echo $v[cat_id];?>" <?php if($train_info['cat_id']==$v[cat_id]){?>selected<?php } ?>><?php echo $v[keyword];?><?php echo $v[cat_name];?></option>
										<?php }
											}
										?>
									</select> <span>*</span></td>
								</tr>
								<tr>
									<td width="75px">归属软件：</td>
									<td><select name="soft_id" id="soft_id" data-rel="chosen">
										<option value="0">选择软件</option>
										<?php if($soft_list){
										foreach($soft_list as $k=>$v) { ?>
											<option value="<?php echo $v[id];?>" <?php if($train_info['soft_id']==$v['id']){?>selected<?php } ?>><?php echo $v[subject];?></option>
										<?php }
											}
										?>
									</select> <span>*</span></td>
								</tr>
								<tr>
									<td>课程名称：</td>
									<td><input class="small-text" type="text" name="subject" value="<?php echo $train_info['subject']; ?>" style="width:200px;" /> <span>*</span></td>
								</tr>
								<tr>
									<td>推荐组合：</td>
									<td><input class="small-text" type="text" name="digg_group" value="<?php echo $train_info['digg_group']; ?>" style="width:400px;" /> <span>（例：51+22+34=60;10+11=12;）</span></td>
								</tr>
								<tr>
									<td>课程课时：</td>
									<td><input class="small-text" type="text" name="keshi" value="<?php echo $train_info['keshi']; ?>" style="width:200px;" /> <span>*</span></td>
								</tr>
								<tr>
									<td>YY频道号：</td>
									<td><input class="small-text" type="text" name="banji" id="banji" value="<?php echo $train_info['banji']; ?>" style="width:200px;" /> <span>*</span></td>
								</tr>
								<tr style="display:none;">
									<td>有效期：</td>
									<td><input class="small-text" type="text" name="stime" id="stime" value="<?php if($train_info['stime']>0){ echo date('Y-m-d h:i',$train_info['stime']); }?>" style="width:108px;" /> - <input class="small-text" type="text" name="etime" id="etime" value="<?php if($train_info['etime']>0){ echo date('Y-m-d h:i',$train_info['etime']); }?>" style="width:108px;" /></td>
								</tr>
								<tr>
									<td width="75px">讲师选择：</td>
									<td><select name="teacher_id" data-rel="chosen">
										<option value="0">选择讲师</option>
										<?php if($teacher_list){
										foreach($teacher_list as $k=>$v) { ?>
											<option value="<?php echo $v[user_id];?>" <?php if($train_info['teacher_id']==$v[user_id]){?>selected<?php }?>><?php echo $v[user_name];?></option>
										<?php }
											}
										?>
									</select> <span>*</span></td>
								</tr>
								<tr>
									<td>原价：</td>
									<td><input class="small-text" type="text" name="oprice" value="<?php echo $train_info['oprice']; ?>" style="width:100px;" /></td>
								</tr>
								<tr>
									<td>优惠价格：</td>
									<td><input class="small-text" type="text" name="price" value="<?php echo $train_info['price']; ?>" style="width:100px;" /></td>
								</tr>
								<tr>
									<td>课程海报：（678px*384px）</td>
									<td><?php if($train_info['imgurl']){?><img src="/<?php echo $train_info['imgurl'];?>" style="max-height:300px;"><?php }?><input type="file" name="imgurl[]" value="<?php echo $train_info['imgurl'];?>" style="width:250px;" maxlength="200" /></td>
								</tr>
								<tr>
									<td width="100px" class="left">课程大纲：</td>
									<td class="left"><a href="javascript:;" onclick="add_new_rj();" title="增加一条">增加一条+</a><input name="kf_rj_num" id="kf_rj_num" type="hidden"  value="<?php echo count($row2);?>">
									</td>
								</tr>
								<tr>
									<td width="100px" class="left"></td>
									<td class="left" id="add_new_rj"> 排序 | 章节 | 小节 
									<?php
									if($row2){
										foreach($row2 as $k=>$v){
											?>

					<div class="fabuxuqiu_h2" id="rj_nums_<?php echo $v['sort'];?>"><span><input type="text" name="sort_<?php echo $v['sort'];?>" style="width:30px;" value="<?php echo $v['sort'];?>"/></span> <span><input type="text" name="sub1_<?php echo $v['sort'];?>" style="width:300px;" value="<?php echo $v['sub1'];?>"/> <input type="text" name="sub2_<?php echo $v['sort'];?>"  value="<?php echo $v['sub2'];?>" style="width:300px;"/> </span><span><a href="javascript:void(0);" onclick="delthis_num(<?php echo $v['sort'];?>);" title="移除">取消</a></span></div>

											<?php
										}
									}
									?>
									</td>
								</tr>
								<tr>
									<td valign="top">课程简介：</td>
									<td style="line-height:18px;">
									<textarea name="summary" style="width:700px;height:200px;visibility:hidden;"><?php echo htmlspecialchars($train_info['summary']); ?></textarea>
									</td>
								</tr>
								<tr>
									<td valign="top">课程详细：</td>
									<td style="line-height:18px;">
									<textarea name="content" style="width:700px;height:400px;visibility:hidden;"><?php echo htmlspecialchars($train_info['content']); ?></textarea>
									</td>
								</tr>
								<tr>
									<td>不显示：</td>
									<td><input type="checkbox" name="is_show" value="1" <?php if($train_info['is_show']){ echo "checked"; }?> /></td>
								</tr>
								<tr>
									<td>是否推荐：</td>
									<td><input type="checkbox" name="is_digg" value="1" <?php if($train_info['is_digg']){ echo "checked"; }?> /></td>
								</tr>
								<input type="hidden" name="id" value="<?php echo $train_info['id']; ?>" />
								<tr><td colspan="2"><span class="button-container"><input class="btn btn-small btn-primary" type="submit" name="submit" value="修改课程" /></span></td></tr>
							</table>
							</form>
							<IFrame id="i_frame" name="i_frame" width="0px" height="0px" style="display:none"></IFrame>
					<script language="JavaScript" src="../servtools/ajax_client/ajax.js"></script>
					<script>
					function add_new_rj(){
					  var now_num=$("#kf_rj_num").val();
					  if(now_num>=280){
						  alert('最多上传280条！');
					  }else{
						  new_num=Number(now_num)+1;
						  $("#kf_rj_num").val(new_num);
						  $("#add_new_rj").append('<div class="fabuxuqiu_h2" id="rj_nums_'+new_num+'"><span><input type="text" name="sort_'+new_num+'" style="width:30px;" value="'+new_num+'"/></span> <span><input type="text" name="sub1_'+new_num+'" style="width:300px;"/> <input type="text" name="sub2_'+new_num+'" style="width:300px;"/> </span><span><a href="javascript:void(0);" onclick="del_new_rj('+new_num+');" title="移除">取消</a></span></div>');
					  }
					}
										
					function delthis_num(val){
						showalert(0,"确定要删除吗？<br /><a href='javascript:;' onclick='del_new_rj("+val+");'>确定</a> 　 <a href='javascript:;' onclick='hiddendiv();'>取消</a>");
					}
					function del_new_rj(this_num){
					  ajax("/ajax/?act=deltrainoutlist","POST","sid="+{echo:$r[3];/}+"&cid="+this_num,function(data){
							if(data=='1') {
							  var now_num=$("#kf_rj_num").val();
							  new_num=Number(now_num)-1;
							  $("#kf_rj_num").val(new_num);
							  $("#rj_nums_"+this_num).remove();
								showalert(1,'删除成功！');
							}else{
								showalert(1,'删除失败！');
							}
					  });
					}
					function updatebanji(val){
							val = val.replace(/-/g,'');
							$('#banji').val($('#banjix').val()+'_'+val);
					}
					function showclassrooms(val){
							var showclasss = document.getElementById("showclasss");
							ajax("/ajax/?act=showclassrooms","POST","sid="+val,function(data){
								if(data) {
									showclasss.innerHTML = data;
								}else{
									showclasss.innerHTML = '无数据';
								}
							});
					}
					function shownums(val){
							var nums = document.getElementById("nums");
							ajax("/ajax/?act=showclassroomnums","POST","sid="+val,function(data){
								if(data) {
									nums.value = data;
								}else{
									nums.value = '';
								}
							});
					}
					</script>

                    
                	<div class="clearboth"></div>
					</div>
                </div>
            </div>
        </div>